import{d as ne,z as A,u as ue,l as ie,a as de,r as n,m as D,A as G,o as re,J as ce,K as _e,L as H,n as _,b as r,c,f as e,i,t as o,q as l,s as a,e as M,w as pe,M as ve,h as me,g as he,F as be,G as fe,p as ge,k as we,_ as ke}from"./index-98139807.js";const d=y=>(ge("data-v-ede94c3f"),y=y(),we(),y),ye={class:"row"},Te={class:"col-12"},Ve={class:"card box-margin"},Le={class:"card-body"},xe={key:0,class:"row"},Ce=d(()=>e("h3",null,"Bot no existe",-1)),Be=[Ce],De={key:1,class:"row"},$e={class:"col-xs-12 col-sm-8"},Se=d(()=>e("b",null,"Bot ",-1)),Ie=d(()=>e("b",null,"Bot ID Databot: ",-1)),Re=d(()=>e("b",null,"assistant_id: ",-1)),Ae=d(()=>e("b",null,"Sesión actual: ",-1)),Me=d(()=>e("b",null,"Modelo: ",-1)),qe={class:"mt-3"},Ee=d(()=>e("h5",null,"Solicitudes API LLM",-1)),Pe={key:0,class:"badge badge-soft-success"},Ne={key:1,class:"badge badge-soft-warning"},Ue={key:2,class:"badge badge-soft-danger"},Oe={key:0,class:"col-xs-12 col-sm-4"},Ke={class:"preview"},ze=["src"],Fe={key:1,class:"col-xs-12 col-sm-4"},je=["src"],Ge=["href"],He=d(()=>e("h5",null,"Consumo de tokens: ",-1)),Je={class:"mb-3"},We={class:""},Qe=d(()=>e("h5",null,"Variables de entrada",-1)),Xe=d(()=>e("br",null,null,-1)),Ye=d(()=>e("div",{class:""},[e("h5",null,"Prompt")],-1)),Ze=d(()=>e("div",{class:""},[e("h5",null,"Respuesta")],-1)),et={class:"dialog-footer"},tt=ne({__name:"PlaygroundView",setup(y){A("$formatDate"),A("$deepCopy");const J=A("$uuid"),T=ue(),q=ie();de();let h;const b=n({}),V=n({}),p=n(""),f=n(0),g=n(0),W=n(0),w=n([]),v=n({}),E=n([]),P=n("gpt-3.5-turbo-0301"),L=n(!0),$=n(!1);n(null);const N=n(0),k=n(!1),S=n(""),x=n(""),U=D(()=>q.query.assistant_id),Q=D(()=>window.location.pathname),X=D(()=>window.location.hostname),Y=D(()=>U.value.split("").reverse().join(""));G(w,()=>{w.value.length===0&&z()}),G(q,u=>{z(),u.fullPath.includes("recommender")?(S.value="recommender",p.value=J()):S.value="bot"},{deep:!0,immediate:!0}),re(()=>{Z(),h&&window.removeEventListener("message",h),h=u=>{const{event:s,payload:C}=u.data;s==="message_sent"&&(console.log("BOT TERMINO DE ESCRIBIR...",C),p.value=C.session_id,O(p.value),K(p.value))},window.addEventListener("message",h)}),ce(()=>{h&&window.removeEventListener("message",h)});async function Z(){b.value=await T.dispatch("assistantsModule/listOne",U.value),ee(1954)}async function ee(u){_e.get(H.DATABOT_DASHBOARD_BACKEND_URL+`/get_bot_info/${u}`).then(s=>{V.value=s.data})}async function O(u){const s=await T.dispatch("llmTrackerModule/getTotalTokens",{by:"session",session_id:u});s.ok&&(console.log("🚀 Aqui *** -> TOKEN USAGE:",s),f.value=s.payload.prompt_tokens,g.value=s.payload.completion_tokens)}async function K(u){w.value=await T.dispatch("llmTrackerModule/list",{session_id:u})}function z(){w.value=[],v.value={},k.value=!1,f.value=0,g.value=0,W.value=0}async function F(){if(x.value.length>0){$.value=!0;const u=await T.dispatch("productsModule/search",{query:x.value,session_id:p.value,useLlm:L.value});E.value=u.payload,O(p.value),K(p.value),$.value=!1}}return(u,s)=>{const C=_("el-option"),te=_("el-select"),m=_("el-table-column"),B=_("el-button"),j=_("el-table"),le=_("el-input"),se=_("el-checkbox"),I=_("el-card"),ae=_("el-form"),oe=_("el-dialog");return r(),c("div",ye,[e("div",Te,[e("div",Ve,[e("div",Le,[V.value?(r(),c("div",De,[e("div",$e,[e("div",null,[Se,i(" "+o(b.value.name),1)]),e("div",null,[Ie,i(" "+o(b.value.bot_id),1)]),e("div",null,[Re,i(" "+o(b.value.assistant_id),1)]),e("div",null,[Ae,i(" "+o(p.value),1)]),e("div",null,[Me,i(" "+o(p.value),1)]),l(te,{modelValue:P.value,"onUpdate:modelValue":s[0]||(s[0]=t=>P.value=t),disabled:"",placeholder:"Modelo"},{default:a(()=>[l(C,{label:"gpt-3.5-turbo-0301",value:"gpt-3.5-turbo-0301",disabled:!0})]),_:1},8,["modelValue"]),e("div",qe,[e("h5",null,"Prompt tokens: "+o(f.value),1)]),e("div",null,[e("h5",null,"Completion tokens: "+o(g.value),1)]),e("div",null,[e("h5",null,"Total para sesión activa: "+o(f.value+g.value),1)]),e("div",null,[e("h5",null,"Costo para sesión activa: "+o(((f.value+g.value)/1e3*.002).toFixed(4))+" usd ",1)]),Ee,l(j,{data:w.value,style:{width:"100%"}},{default:a(()=>[l(m,{prop:"is_stream",label:"Stream?",width:"180"}),l(m,{prop:"status_request",label:"Código Respuesta",width:"180"},{default:a(t=>[t.row.status_request==="200"?(r(),c("span",Pe,"200 OK")):M("v-if",!0),t.row.status_request==="408"?(r(),c("span",Ne,"408 Timeout")):M("v-if",!0),t.row.status_request==="500"?(r(),c("span",Ue,"500 Error")):M("v-if",!0)]),_:1}),l(m,{prop:"response_time",label:"Tiempo respuesta(segs)",width:"180"},{default:a(t=>[e("ul",null,[e("li",null,o(t.row.response_time),1),pe(e("li",null,o(t.row.response_time_before_stream)+" antes de stream ",513),[[ve,t.row.is_stream]])])]),_:1}),l(m,{prop:"total_tokens",label:"Tokens"}),l(m,{prop:"response",label:"Detalle"},{default:a(t=>[l(B,{size:"small",type:"primary",onClick:R=>{v.value=t.row,k.value=!0}},{default:a(()=>[i("Ver detalle")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),S.value==="bot"?(r(),c("div",Oe,[l(B,{size:"small",type:"primary",onClick:s[1]||(s[1]=t=>N.value+=1)},{default:a(()=>[i("Recargar iframe bot")]),_:1}),e("div",Ke,[(r(),c("iframe",{key:N.value,class:"expand",src:`${me(H).DATABOT_BOT_URL}/bot?id=${V.value.id}&token=${V.value.token}&clientPathName=${Q.value}&clientHostName=${X.value}&isPlayground=true&assistant_id=${Y.value}&playground_bot_id=${b.value.bot_id}`},null,8,ze))])])):(r(),c("div",Fe,[l(le,{class:"mb-2",modelValue:x.value,"onUpdate:modelValue":s[2]||(s[2]=t=>x.value=t),placeholder:"Búsqueda para recomendación",clearable:"",onKeyup:he(F,["enter"])},null,8,["modelValue","onKeyup"]),l(B,{type:"primary",onClick:F,loading:$.value},{default:a(()=>[i("Buscar")]),_:1},8,["loading"]),l(se,{class:"ml-3",modelValue:L.value,"onUpdate:modelValue":s[3]||(s[3]=t=>L.value=t)},{default:a(()=>[i(o(L.value?"Usar LLM para búsqueda":"Sin LLM"),1)]),_:1},8,["modelValue"]),l(j,{data:E.value,stripe:"",style:{width:"100%"}},{default:a(()=>[l(m,{label:"Imagen",prop:"image_url"},{default:a(t=>[e("img",{src:t.row.image_url,alt:"Imagen",width:"100",height:"100"},null,8,je)]),_:1}),l(m,{label:"Nombre",prop:"name"},{default:a(t=>[e("span",null,o(t.row.name),1),i(" link "),e("div",null,[e("a",{href:t.row.product_url,target:"_blank"},"Ver",8,Ge)])]),_:1}),l(m,{label:"Categorías",prop:"categories"}),l(m,{label:"Disponible",prop:"available"})]),_:1},8,["data"])]))])):(r(),c("div",xe,Be))])])]),l(oe,{modelValue:k.value,"onUpdate:modelValue":s[5]||(s[5]=t=>k.value=t),title:"Detalles de solicitud a LLM "+(v.value.is_stream?"(Solicitud stream final)":"(Solicitud intermedia)"),width:"50%"},{footer:a(()=>[e("span",et,[l(B,{type:"success",onClick:s[4]||(s[4]=t=>k.value=!1)},{default:a(()=>[i(" Listo ")]),_:1})])]),default:a(()=>[l(ae,{"label-position":"top","label-width":"100px"},{default:a(()=>[He,e("ul",Je,[e("li",null,"prompt_tokens: "+o(v.value.prompt_tokens),1),e("li",null,"completion_tokens: "+o(v.value.completion_tokens),1),e("li",null,"Total: "+o(v.value.total_tokens),1)]),l(I,{shadow:"never",class:"box-card mb-2"},{header:a(()=>[e("div",We,[Qe,e("ul",null,[(r(!0),c(be,null,fe(v.value.input_variables,(t,R)=>(r(),c("li",{key:R},[e("b",null,"- "+o(R),1),i(":"),Xe,e("pre",null,o(t),1)]))),128))])])]),_:1}),l(I,{shadow:"never",class:"box-card mb-2"},{header:a(()=>[Ye]),default:a(()=>[e("pre",null,o(v.value.prompt),1)]),_:1}),l(I,{shadow:"never",class:"box-card mb-2"},{header:a(()=>[Ze]),default:a(()=>[e("pre",null,o(v.value.response),1)]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}});const at=ke(tt,[["__scopeId","data-v-ede94c3f"],["__file","D:/programming/Work/Databot/databot_ia_frontend/src/views/PlaygroundView.vue"]]);export{at as default};
