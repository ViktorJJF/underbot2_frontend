import{d as xe,r,f as Fe,c as ce,z as Te,h as ke,D as Ae,Q as de,R as Me,S as $,k as y,o as m,a as U,e,b as v,n as b,F as H,u as ee,A as G,l as L,w as Pe,C as Se,t as l,p as k,B as te,q as Ne,G as Qe,E as Ie}from"./index-1x2_oIEt.js";import{s as me}from"./index-gacbde3m.js";const Ee={class:"container"},$e={class:"row my-3"},qe={class:"col-sm-3"},Oe={class:"col-sm-3"},ze=e("span",{class:""},"Desde",-1),He={class:"col-sm-3"},Ge=e("span",{class:""},"Hasta",-1),Le={class:"col-sm-3"},Re=e("span",{class:""},"Ambos",-1),We={class:"row"},je=e("div",null,[e("h6")],-1),Je={class:"row"},Ke={class:"col-sm-6"},Xe=e("h4",null,"Resultados simulación",-1),Ye={class:"match-ended"},Ze={class:"d-inline"},be=e("h6",{class:"d-inline"},"Winrate:",-1),et=e("h6",{class:"d-inline"},"Dinero Apostado:",-1),tt=e("h6",{class:"d-inline"},"Dinero Obtenido:",-1),at=e("h6",{class:"d-inline"},"Ganancia neta:",-1),st=e("h6",{class:"d-inline"},"Beneficio:",-1),lt={class:"col-sm-6"},ot={class:"col-sm-4"},nt={class:"table"},it=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Fecha"),e("th",{scope:"col"},"Match"),e("th",{scope:"col"},"Total"),e("th",{scope:"col"},"Bet"),e("th",{scope:"col"},"Apostado"),e("th",{scope:"col"},"Under Quota"),e("th",{scope:"col"},"Beneficio"),e("th",{scope:"col"},"Over Quota"),e("th",{scope:"col"},"Cuarto"),e("th",{scope:"col"},"Score"),e("th",{scope:"col"},"Cantidad de montañas"),e("th",{scope:"col"},"Diferencia ups/downs %"),e("th",{scope:"col"},"¿Primera apuesta?")])],-1),ut={scope:"row"},rt=["href"],pt=xe({__name:"SimulationView",setup(ct){const A=r([]),R=r(new Date(me(new Date,1))),W=r(new Date(me(new Date,1))),j=r(new Date("2023-10-26")),q=r(null),J=r(!1),M=r(0),O=r(0),ae=r(0),se=r(0),P=r([]);r({});const _=r({wins:0,losses:0,winrate:0}),D=r({wins:0,losses:0,winrate:0}),le=r(0),h=r({fromQuarter:[!0,"c4","Evaluar desde","text"],untilQuarter:[!0,"c4","Evaluar hasta","text"],fromTime:[!0,12*60*1e3,"Desde (milisegundos) (Faltando 2 min para acabar c3) ","number"],untilTime:[!0,5*60*1e3,"Hasta (milisegundos) (Antes de llegar al minuto 5 de c4)","number"],minUnderPercent:[!1,80,"Mínimo porcentaje de Under","number"],hasUnderBeatOver:[!1,!1,"Under supera o iguala over","boolean"],minimalScoreDifference:[!1,8,"Mínima diferencia de score (pendiente) (NEW)","number"],minimalUpsDownsDifference:[!0,.1,"Mínima diferencia de Ups/Downs %","number"],hasInvertedCones:[!0,!0,"Evaluar gráfica en forma de montañas","boolean"],minimalDifferenceToNextBet:[!0,2,"Mínima diferencia para apostar de nuevo en mismo match","number"],moneyBet:[!0,333,"Dinero a apostar (Primera apuesta cebo)","number"],moneyNextBet:[!0,533,"Dinero a apostar (Siguientes apuestas)","number"],ignoreFirstBet:[!1,!0,"Ignorar primera apuesta","boolean"]}),x=Fe(),ve=ce(()=>P.value),p=ce(()=>h.value.ignoreFirstBet[0]&&h.value.ignoreFirstBet[1]?P.value.filter(a=>!a.isFirstBet):ve.value);Te(h,()=>{clearTimeout(se.value),se.value=setTimeout(()=>{oe()},500)},{deep:!0}),ke(async()=>{await S()});async function S(){const a={sort:"createdAt",order:"desc",dateFrom:R.value,dateTo:W.value,dateBoth:j.value};q.value&&(a.teamId=q.value),await Promise.all([x.dispatch("matchesModule/list",a),x.dispatch("teamsModule/list",{sort:"name",order:"asc",league:"NBA"})]),A.value=x.state.matchesModule.matches,A.value=A.value.map(s=>({...s,unders:Ae(s.odds)})),console.log("🐞 LOG HERE matches.value:",A.value.length),oe()}async function oe(){J.value=!0,we(),await he(),ye(),J.value=!1}async function he(){for(const a of A.value)await pe(a);_e(p.value)}async function pe(a){a.externalId;let s={},f,c=[],i={},w=!1,B=!0;const N=a.unders.filter(o=>o.quarter!=="c4");let F=[];const{fromQuarter:C,untilQuarter:t,fromTime:d,untilTime:u,minUnderPercent:ie,hasUnderBeatOver:ue,minimalScoreDifference:dt,minimalUpsDownsDifference:z,hasInvertedCones:Q,moneyBet:Be,moneyNextBet:Ce,minimalDifferenceToNextBet:re}=h.value;Q[0]&&Q[1]&&(c=de(a.unders.filter(o=>o.quarter!="c4"),a.teams.some(o=>g(o.name))?9:12),console.log("🐞 LOG HERE invertedCones:",c)),(z[0]||z[0]&&z[1])&&(i=Me(N),console.log("Ups downs: ",i.upsCounterPercent,i.downsCounterPercent,i.upsCounterPercent-i.downsCounterPercent),i.upsCounterPercent-i.downsCounterPercent>=parseFloat(z[1])&&(w=!0));for(const o of a.unders)if(F.push(o),o.quarter=="c4"&&(!a.teams.some(V=>g(V.name))||a.teams.some(V=>g(V.name))&&o.millis&&o.millis!=0&&o.millis<7*60*1e3)){a.teams.some(n=>g(n.name))&&o.millis&&o.millis!=0&&o.millis<7*60*1e3&&(c=de(F,(a.teams.some(n=>g(n.name)),12)));const V=o.value,I=o.quarter,E=o.millis,K=o.underQuota,X=o.overQuota,Ve=o.scores;let Y=parseInt(I[1].match(/\d+/)[0]);const Ue=[{isActive:C[0]&&t[0],condition:Y&&Y>=C[1].match(/\d+/)[0]&&Y<=t[1].match(/\d+/)[0]},{isActive:d[0]&&u[0],condition:(I==C[1]?E<=parseInt(d[1]):!0)&&(I==t[1]?E>=parseInt(u[1]):!0)||I=="c4"&&(E===0||!E)},{isActive:ie[0],condition:s.underPercent&&s.underPercent>=parseFloat(ie[1])},{isActive:ue[0],condition:ue[1]?K>=X:K<=X},{isActive:Q[0],condition:Q[0]&&Q[1]?c.length==0:!0}];let T=P.value.filter(n=>n.matchId==a._id);if(i.upsCounterPercent-i.downsCounterPercent>=.24||(w||a.teams.some(n=>g(n.name)))&&T.length>0||a.teams.every(n=>g(n.name))||a.teams.some(n=>De(n.name))&&T.length>2)return;if(!T.find(n=>n.matchId===a._id&&n.type==="U"&&n.score===V)){let n=T[T.length-1];(!n||n&&n.value<=V-(re[0]?parseInt(re[1]):2))&&Ue.filter(Z=>Z.isActive).every((Z,mt)=>Z.condition)&&(fe(a,V,"U",E,I,K,X,Ve||[],f,c.length?c.length:0,i?i.upsCounterPercent-i.downsCounterPercent:0,T.length==0?Be[1]:Ce[1],B),B&&(B=!1))}}}function fe(a,s,f,c,i,w,B,N,F,C,t,d,u){P.value.push({matchId:a._id,value:s,type:f,millis:c,quarter:i,underQuota:w,overQuota:B,scores:N,historicalUnder:F,match:a,invertedConesLength:C,upsDownsDifference:t,money:d,isFirstBet:u})}function _e(a){a.forEach((s,f)=>{s.type==="U"?s.value>s.match.scoresDetailed.home+s.match.scoresDetailed.away?(_.value.wins++,a[f].win=!0):(_.value.losses++,a[f].win=!1):s.value<s.match.scoresDetailed.home+s.match.scoresDetailed.away?D.value.wins++:D.value.losses++}),_.value.winrate=$(_.value.wins/p.value.length),D.value.winrate=$(D.value.wins/p.value.length),le.value=$((_.value.wins+D.value.wins)/p.value.length)}function we(){P.value=[],_.value.wins=0,_.value.losses=0,D.value.wins=0,D.value.losses=0}function ye(){h.value.moneyBet[1]=parseFloat(h.value.moneyBet[1]),h.value.moneyNextBet[1]=parseFloat(h.value.moneyNextBet[1]),M.value=p.value.reduce((a,s)=>a+parseFloat(s.money),0),O.value=$(p.value.reduce((a,s)=>((s.type==="U"&&s.value>s.match.scoresDetailed.home+s.match.scoresDetailed.away||s.type==="O"&&s.value<s.match.scoresDetailed.home+s.match.scoresDetailed.away)&&(a+=(s.underQuota||1.63)*parseFloat(s.money)),a),0)),ae.value=$((O.value-M.value)/M.value)}function g(a){return[].includes(a)}function De(a){return[].includes(a)}function ge(){window.open("/simulations-teams?");for(const a of x.state.teamsModule.teams)x.commit("simulationsModule/addSimulation",a)}function ne(a){return a.type==="U"&&a.value>a.match.scoresDetailed.home+a.match.scoresDetailed.away||a.type==="O"&&a.value<a.match.scoresDetailed.home+a.match.scoresDetailed.away}return(a,s)=>{const f=y("el-option"),c=y("el-select"),i=y("el-date-picker"),w=y("el-divider"),B=y("el-checkbox"),N=y("el-switch"),F=y("el-input"),C=y("el-button");return m(),U("div",null,[e("div",Ee,[e("div",$e,[e("div",qe,[v(c,{modelValue:q.value,"onUpdate:modelValue":s[0]||(s[0]=t=>q.value=t),placeholder:"Filtrar equipo",onChange:S,clearable:""},{default:b(()=>[(m(!0),U(H,null,L(ee(x).state.teamsModule.teams,(t,d)=>(m(),G(f,{key:d,label:t.name,value:t._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e("div",Oe,[ze,v(i,{onChange:S,class:"mx-2",modelValue:R.value,"onUpdate:modelValue":s[1]||(s[1]=t=>R.value=t),type:"date",placeholder:"Desde",size:"large"},null,8,["modelValue"])]),e("div",He,[Ge,v(i,{onChange:S,class:"mx-2",modelValue:W.value,"onUpdate:modelValue":s[2]||(s[2]=t=>W.value=t),type:"date",placeholder:"Hasta",size:"large"},null,8,["modelValue"])]),e("div",Le,[Re,v(i,{onChange:S,class:"mx-2",modelValue:j.value,"onUpdate:modelValue":s[3]||(s[3]=t=>j.value=t),type:"date",placeholder:"Ambos",size:"large"},null,8,["modelValue"])])]),v(w),e("div",We,[(m(!0),U(H,null,L(h.value,(t,d)=>(m(),U("div",{key:d,class:"col-sm-6"},[v(B,{label:t[2],modelValue:t[0],"onUpdate:modelValue":u=>t[0]=u,size:"large"},null,8,["label","modelValue","onUpdate:modelValue"]),e("div",null,[typeof t[1]=="boolean"?(m(),G(N,{key:0,class:"d-block mb-2",modelValue:t[1],"onUpdate:modelValue":u=>t[1]=u,"active-text":"Sí",disabled:!t[0],"inactive-text":"No"},null,8,["modelValue","onUpdate:modelValue","disabled"])):te("",!0)]),t[3]=="number"?(m(),G(F,{key:0,type:t[3],disabled:!t[0],modelValue:t[1],"onUpdate:modelValue":u=>t[1]=u},null,8,["type","disabled","modelValue","onUpdate:modelValue"])):te("",!0),t[3]=="text"?(m(),G(c,{key:1,modelValue:t[1],"onUpdate:modelValue":u=>t[1]=u},{default:b(()=>[(m(),U(H,null,L(["c1","c2","c3","c4"],u=>v(f,{key:u,label:u,value:u},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):te("",!0)]))),128))]),je,v(w),e("div",Je,[e("div",Ke,[Xe,Pe(e("h5",Ye,"(Calculando)",512),[[Se,J.value]]),e("h6",Ze," Cantidad de apuestas: "+l(p.value.length),1),e("div",null,[be,k(" "+l(((le.value||0)*100).toFixed(2))+"% ("+l(_.value.wins)+"/"+l(p.value.length)+") ",1)]),e("div",null,[et,k(" $ "+l(M.value),1)]),e("div",null,[tt,k(" $ "+l(O.value),1)]),e("div",null,[at,k(" $ "+l((O.value-M.value).toFixed(2)),1)]),e("div",null,[st,k(" "+l((ae.value*100).toFixed(2))+"% ",1)])]),e("div",lt,[e("div",ot,[v(C,{small:"",type:"primary",plain:"",onClick:ge},{default:b(()=>[k("Simular por equipo")]),_:1})])])]),v(w),e("table",nt,[it,e("tbody",null,[(m(!0),U(H,null,L(p.value,(t,d)=>(m(),U("tr",{class:Ne(t.match.hasOvertime?"table-danger":""),key:d},[e("th",ut,l(d+1),1),e("td",null,l(ee(Qe)(t.match.createdAt)),1),e("td",null,[e("a",{href:`/matches/${t.match._id}`,target:"_blank"},l(`${t.match.teams[0].name} (${t.match.scoresDetailed.home}) - (${t.match.scoresDetailed.away}) ${t.match.teams[1].name}`),9,rt)]),e("td",null,l(t.match.scoresDetailed.home+t.match.scoresDetailed.away),1),e("td",null,l(t.type)+" "+l(t.value)+" - "+l(t.quarter)+" "+l(ne(t)?"✅":"❌"),1),e("td",null,"S/. "+l(t.money),1),e("td",null,l(t.underQuota),1),e("td",null,l(ne(t)?`- S/. ${(t.money*(t.underQuota-1)).toFixed(2)}`:`- ${t.money}`),1),e("td",null,l(t.overQuota),1),e("td",null,l(t.quarter)+" "+l(ee(Ie)(t.millis)),1),e("td",null,l(t.scoresDetailed?`${t.scoresDetailed.home} - ${t.scoresDetailed.away}`:"Sin scores"),1),e("td",null,l(t.invertedConesLength),1),e("td",null,l(t.isFirstBet?"Sí":"No"),1),e("td",null,l(t.match.externalId),1)],2))),128))])])])])}}});export{pt as default};
