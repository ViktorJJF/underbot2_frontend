import{d as ae,l as S,m as oe,u as ne,b as ie,r as n,e as D,q as F,s as ue,G as de,H as re,I as H,f as v,o as d,c as r,h as e,x as c,t as o,i as s,w as l,g as A,J as ce,K as _e,v as pe,L as ve,F as me,B as he,p as fe,k as be,_ as ge}from"./index-f3d649f4.js";const u=y=>(fe("data-v-ede94c3f"),y=y(),be(),y),we={class:"row"},ye={class:"col-12"},ke={class:"card box-margin"},Te={class:"card-body"},Ve={key:0,class:"row"},xe=u(()=>e("h3",null,"Bot no existe",-1)),Ce=[xe],Be={key:1,class:"row"},De={class:"col-xs-12 col-sm-8"},Le=u(()=>e("b",null,"Bot ",-1)),$e=u(()=>e("b",null,"Bot ID Databot: ",-1)),Ie=u(()=>e("b",null,"assistant_id: ",-1)),Re=u(()=>e("b",null,"Sesión actual: ",-1)),Se=u(()=>e("b",null,"Modelo: ",-1)),Ae={class:"mt-3"},Pe=u(()=>e("h5",null,"Solicitudes API LLM",-1)),Ee={key:0,class:"badge badge-soft-success"},qe={key:1,class:"badge badge-soft-warning"},Me={key:2,class:"badge badge-soft-danger"},Ne={key:0,class:"col-xs-12 col-sm-4"},Oe={class:"preview"},Ue=["src"],Ke={key:1,class:"col-xs-12 col-sm-4"},je=["src"],ze=["href"],Fe=u(()=>e("h5",null,"Consumo de tokens: ",-1)),He={class:"mb-3"},Ge={class:""},Je=u(()=>e("h5",null,"Variables de entrada",-1)),Qe=u(()=>e("br",null,null,-1)),We=u(()=>e("div",{class:""},[e("h5",null,"Prompt")],-1)),Xe=u(()=>e("div",{class:""},[e("h5",null,"Respuesta")],-1)),Ye={class:"dialog-footer"},Ze=ae({__name:"PlaygroundView",setup(y){S("$formatDate"),S("$deepCopy");const G=S("$uuid"),k=oe(),P=ne();ie();let h;const T=n({}),V=n({}),_=n(""),f=n(0),b=n(0),J=n(0),g=n([]),p=n({}),E=n([]),q=n("gpt-3.5-turbo-0301"),L=n(!1);n(null);const M=n(0),w=n(!1),$=n(""),x=n(""),N=D(()=>P.query.assistant_id),Q=D(()=>window.location.pathname),W=D(()=>window.location.hostname),X=D(()=>N.value.split("").reverse().join(""));F(g,()=>{g.value.length===0&&K()}),F(P,i=>{K(),i.fullPath.includes("recommender")?($.value="recommender",_.value=G()):$.value="bot"},{deep:!0,immediate:!0}),ue(()=>{Y(),h&&window.removeEventListener("message",h),h=i=>{const{event:a,payload:C}=i.data;a==="message_sent"&&(console.log("BOT TERMINO DE ESCRIBIR...",C),_.value=C.session_id,O(_.value),U(_.value))},window.addEventListener("message",h)}),de(()=>{h&&window.removeEventListener("message",h)});async function Y(){T.value=await k.dispatch("assistantsModule/listOne",N.value),Z(1954)}async function Z(i){re.get(H.DATABOT_DASHBOARD_BACKEND_URL+`/get_bot_info/${i}`).then(a=>{V.value=a.data})}async function O(i){const a=await k.dispatch("llmTrackerModule/getTotalTokens",{by:"session",session_id:i});a.ok&&(console.log("🚀 Aqui *** -> TOKEN USAGE:",a),f.value=a.payload.prompt_tokens,b.value=a.payload.completion_tokens)}async function U(i){g.value=await k.dispatch("llmTrackerModule/list",{session_id:i})}function K(){g.value=[],p.value={},w.value=!1,f.value=0,b.value=0,J.value=0}async function j(){if(x.value.length>0){L.value=!0;const i=await k.dispatch("productsModule/search",{query:x.value,session_id:_.value});E.value=i.payload,O(_.value),U(_.value),L.value=!1}}return(i,a)=>{const C=v("el-option"),ee=v("el-select"),m=v("el-table-column"),B=v("el-button"),z=v("el-table"),te=v("el-input"),I=v("el-card"),se=v("el-form"),le=v("el-dialog");return d(),r("div",we,[e("div",ye,[e("div",ke,[e("div",Te,[V.value?(d(),r("div",Be,[e("div",De,[e("div",null,[Le,c(" "+o(T.value.name),1)]),e("div",null,[$e,c(" "+o(T.value.bot_id),1)]),e("div",null,[Ie,c(" "+o(T.value.assistant_id),1)]),e("div",null,[Re,c(" "+o(_.value),1)]),e("div",null,[Se,c(" "+o(_.value),1)]),s(ee,{modelValue:q.value,"onUpdate:modelValue":a[0]||(a[0]=t=>q.value=t),disabled:"",placeholder:"Modelo"},{default:l(()=>[s(C,{label:"gpt-3.5-turbo-0301",value:"gpt-3.5-turbo-0301",disabled:!0})]),_:1},8,["modelValue"]),e("div",Ae,[e("h5",null,"Prompt tokens: "+o(f.value),1)]),e("div",null,[e("h5",null,"Completion tokens: "+o(b.value),1)]),e("div",null,[e("h5",null,"Total para sesión activa: "+o(f.value+b.value),1)]),e("div",null,[e("h5",null,"Costo para sesión activa: "+o(((f.value+b.value)/1e3*.002).toFixed(4))+" usd ",1)]),Pe,s(z,{data:g.value,style:{width:"100%"}},{default:l(()=>[s(m,{prop:"is_stream",label:"Stream?",width:"180"}),s(m,{prop:"status_request",label:"Código Respuesta",width:"180"},{default:l(t=>[t.row.status_request==="200"?(d(),r("span",Ee,"200 OK")):A("v-if",!0),t.row.status_request==="408"?(d(),r("span",qe,"408 Timeout")):A("v-if",!0),t.row.status_request==="500"?(d(),r("span",Me,"500 Error")):A("v-if",!0)]),_:1}),s(m,{prop:"response_time",label:"Tiempo respuesta(segs)",width:"180"},{default:l(t=>[e("ul",null,[e("li",null,o(t.row.response_time),1),ce(e("li",null,o(t.row.response_time_before_stream)+" antes de stream ",513),[[_e,t.row.is_stream]])])]),_:1}),s(m,{prop:"total_tokens",label:"Tokens"}),s(m,{prop:"response",label:"Detalle"},{default:l(t=>[s(B,{size:"small",type:"primary",onClick:R=>{p.value=t.row,w.value=!0}},{default:l(()=>[c("Ver detalle")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),$.value==="bot"?(d(),r("div",Ne,[s(B,{size:"small",type:"primary",onClick:a[1]||(a[1]=t=>M.value+=1)},{default:l(()=>[c("Recargar iframe bot")]),_:1}),e("div",Oe,[(d(),r("iframe",{key:M.value,class:"expand",src:`${pe(H).DATABOT_BOT_URL}/bot?id=${V.value.id}&token=${V.value.token}&clientPathName=${Q.value}&clientHostName=${W.value}&isPlayground=true&assistant_id=${X.value}`},null,8,Ue))])])):(d(),r("div",Ke,[s(te,{class:"mb-2",modelValue:x.value,"onUpdate:modelValue":a[2]||(a[2]=t=>x.value=t),placeholder:"Búsqueda para recomendación",clearable:"",onKeyup:ve(j,["enter"])},null,8,["modelValue","onKeyup"]),s(B,{type:"primary",onClick:j,loading:L.value},{default:l(()=>[c("Buscar")]),_:1},8,["loading"]),s(z,{data:E.value,stripe:"",style:{width:"100%"}},{default:l(()=>[s(m,{label:"Imagen",prop:"image_url"},{default:l(t=>[e("img",{src:t.row.image_url,alt:"Imagen",width:"100",height:"100"},null,8,je)]),_:1}),s(m,{label:"Nombre",prop:"name"},{default:l(t=>[e("span",null,o(t.row.name),1),c(" link "),e("div",null,[e("a",{href:t.row.product_url,target:"_blank"},"Ver",8,ze)])]),_:1}),s(m,{label:"Categorías",prop:"categories"})]),_:1},8,["data"])]))])):(d(),r("div",Ve,Ce))])])]),s(le,{modelValue:w.value,"onUpdate:modelValue":a[4]||(a[4]=t=>w.value=t),title:"Detalles de solicitud a LLM "+(p.value.is_stream?"(Solicitud stream final)":"(Solicitud intermedia)"),width:"50%"},{footer:l(()=>[e("span",Ye,[s(B,{type:"success",onClick:a[3]||(a[3]=t=>w.value=!1)},{default:l(()=>[c(" Listo ")]),_:1})])]),default:l(()=>[s(se,{"label-position":"top","label-width":"100px"},{default:l(()=>[Fe,e("ul",He,[e("li",null,"prompt_tokens: "+o(p.value.prompt_tokens),1),e("li",null,"completion_tokens: "+o(p.value.completion_tokens),1),e("li",null,"Total: "+o(p.value.total_tokens),1)]),s(I,{shadow:"never",class:"box-card mb-2"},{header:l(()=>[e("div",Ge,[Je,e("ul",null,[(d(!0),r(me,null,he(p.value.input_variables,(t,R)=>(d(),r("li",{key:R},[e("b",null,"- "+o(R),1),c(":"),Qe,e("pre",null,o(t),1)]))),128))])])]),_:1}),s(I,{shadow:"never",class:"box-card mb-2"},{header:l(()=>[We]),default:l(()=>[e("pre",null,o(p.value.prompt),1)]),_:1}),s(I,{shadow:"never",class:"box-card mb-2"},{header:l(()=>[Xe]),default:l(()=>[e("pre",null,o(p.value.response),1)]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}});const st=ge(Ze,[["__scopeId","data-v-ede94c3f"],["__file","D:/Programacion/Trabajo/Databot/vue3_ts_skeleton/src/views/PlaygroundView.vue"]]);export{st as default};
